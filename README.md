# Рекомендательная система Яндекс.Музыка

## Архитектура

Система состоит из 3 микросервисов:

### 1. **recommendations** (порт 8000) — главный сервис
- `/recommendations` — офлайн рекомендации (персональные ALS или топ популярные)
- `/recommendations_online` — онлайн рекомендации на основе последних действий

### 2. **events_store** (порт 8001) — хранилище событий
- `/put` — сохранение события (user послушал track)
- `/get` — получение последних k событий пользователя

### 3. **similar_items** (порт 8002) — похожие треки
- `/similar_items` — возвращает похожие треки (item-to-item)

## Стратегия смешивания рекомендаций

### Офлайн-рекомендации
1. **Персональные (ALS)**: если есть история пользователя → выдаём персональные рекомендации
2. **Топ популярные**: fallback для новых пользователей без истории (Если нет онлайн-истории или нет похожих треков, то возвращаем персональные/топ популярные)

### Онлайн-рекомендации
1. Получаем последние 3 трека, которые слушал пользователь
2. Для каждого трека находим похожие через ALS similar_items
3. Объединяем списки, сортируем по score
4. Дедуплицируем и возвращаем топ-k


## Запуск
```bash
# Терминал 1
uvicorn events_store:app --port 8001

# Терминал 2  
uvicorn similar_items:app --port 8002

# Терминал 3
uvicorn recommendations:app --port 8000
```

## Тестирование
```bash
python test_service.py 
```
